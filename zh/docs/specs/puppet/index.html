<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specs/puppet" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Wechaty Puppet | Wechaty</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://wechaty.js.org/zh/img/wechaty-logo.svg"><meta data-rh="true" name="twitter:image" content="https://wechaty.js.org/zh/img/wechaty-logo.svg"><meta data-rh="true" property="og:url" content="https://wechaty.js.org/zh/docs/specs/puppet"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Wechaty Puppet | Wechaty"><meta data-rh="true" name="description" content="What is Wechaty Puppet"><meta data-rh="true" property="og:description" content="What is Wechaty Puppet"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wechaty.js.org/zh/docs/specs/puppet"><link data-rh="true" rel="alternate" href="https://wechaty.js.org/docs/specs/puppet" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://wechaty.js.org/zh/docs/specs/puppet" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://wechaty.js.org/docs/specs/puppet" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Wechaty RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Wechaty Atom Feed">






<link rel="search" type="application/opensearchdescription+xml" title="Wechaty" href="/zh/opensearch.xml">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PD2PL84",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>

<link rel="icon" href="/zh/img/icon.png">
<link rel="manifest" href="/zh/manifest.json">
<meta name="theme-color" content="rgb(8, 168, 56)">

<link rel="stylesheet" href="/css/gitter-sidecar.css">
<script src="/js/gitter-sidecar.js"></script>
<script src="/js/baidu-statistics.js"></script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async></script><link rel="stylesheet" href="/zh/assets/css/styles.a9c331e0.css">
<link rel="preload" href="/zh/assets/js/runtime~main.2ba15057.js" as="script">
<link rel="preload" href="/zh/assets/js/main.b3311afd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PD2PL84" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus">
<div role="region" aria-label="Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav aria-label="‰∏ªÂØºËà™" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ÂàáÊç¢ÂØºËà™Ê†è" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://wechaty.js.org/news/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">News<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://wechaty.js.org/blog/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://wechaty.js.org/contributors/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contributors<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/wechaty">Introduction</a></li><li><a class="dropdown__link" href="/zh/docs/tutorials/">Tutorials</a></li><li><a class="dropdown__link" href="/zh/docs/howto/">How-to Guides</a></li><li><a class="dropdown__link" href="/zh/docs/references/">References</a></li><li><a class="dropdown__link" href="/zh/docs/explanations/">Explanations</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>‰∏≠Êñá</a><ul class="dropdown__menu"><li><a href="/docs/specs/puppet" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/zh/docs/specs/puppet" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">‰∏≠Êñá</a></li></ul></div><a href="https://github.com/wechaty/wechaty#readme" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="ÊêúÁ¥¢" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="ÂõûÂà∞È°∂ÈÉ®" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/zh/"><img src="/zh/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/wechaty-logo.svg" alt="Wechaty Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav aria-label="ÊñáÊ°£‰æßËæπÊ†è" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/tutorials/">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/howto/">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/docs/references/">References</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/references/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh/docs/api/">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh/docs/polyglot/">Polyglot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh/docs/puppet-providers/">Puppet Providers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh/docs/puppet-services/">Puppet Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/zh/docs/specs/">Specifications</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/">Specs: Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/wechaty">Wechaty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/plugin">Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/specs/puppet">Puppet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/service">Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/token">Token</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/specs/gateway">Gateway</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/references/breaking-changes">Breaking Changes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/explanations/">Explanations</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="È°µÈù¢Ë∑ØÂæÑ"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="‰∏ªÈ°µÈù¢" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">References</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Specifications</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Puppet</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Êú¨È°µÊÄªËßà</button></div><div class="theme-doc-markdown markdown"><header><h1>Wechaty Puppet</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-wechaty-puppet">What is Wechaty Puppet<a href="#what-is-wechaty-puppet" class="hash-link" aria-label="What is Wechaty PuppetÁöÑÁõ¥Êé•ÈìæÊé•" title="What is Wechaty PuppetÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>The term <code>Puppet</code> in Wechaty is an Abstract Class for implementing protocol plugins. The plugins are the components that help the  Wechaty to control the IMs like WeChat.
The plugins are named <code>PuppetXXX</code>, like <a href="https://github.com/wechaty/wechaty-puppet-puppeteer" target="_blank" rel="noopener noreferrer">PuppetPuppeteer</a> is using the <a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener noreferrer">google puppeteer</a> to control the <a href="https://wx.qq.com" target="_blank" rel="noopener noreferrer">WeChat Web API</a> via a chrome browser, <a href="https://github.com/padlocal/wechaty-puppet-padlocal" target="_blank" rel="noopener noreferrer">PuppetPadLocal</a> is using the Pad Protocol to connect with WeChat Server.
For better understanding of the Puppet below are some links listed down:</p><ul><li>Puppet Providers Directory: <a href="https://wechaty.js.org/docs/puppet-providers/" target="_blank" rel="noopener noreferrer">https://wechaty.js.org/docs/puppet-providers/</a></li><li>Puppet Compatibility Table: <a href="https://wechaty.js.org/docs/puppet-services/compatibility/" target="_blank" rel="noopener noreferrer">https://wechaty.js.org/docs/puppet-services/compatibility/</a></li><li>Puppet Development Guide: <a href="https://wechaty.js.org/docs/puppet-providers/diy" target="_blank" rel="noopener noreferrer">https://wechaty.js.org/docs/puppet-providers/diy</a></li><li>Puppet Related Links: <a href="https://github.com/wechaty/wechaty-puppet/wiki/Links" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/wiki/Links</a></li><li>Puppet Documentation: <a href="https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html" target="_blank" rel="noopener noreferrer">https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="show-me-the-code">Show me the code<a href="#show-me-the-code" class="hash-link" aria-label="Show me the codeÁöÑÁõ¥Êé•ÈìæÊé•" title="Show me the codeÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>For a deeper understanding of the Puppet in Wechaty, you can read its documentation from <a href="https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html" target="_blank" rel="noopener noreferrer">https://wechaty.github.io/wechaty-puppet/typedoc/classes/puppet.html</a> and source code if you like at <a href="https://github.com/wechaty/wechaty-puppet/blob/main/src/puppet.ts" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/blob/main/src/puppet.ts</a>
Below is an architectural diagram of Wechaty Puppet.</p><p><img loading="lazy" alt="abstract puppet" src="/zh/assets/images/architecture-ef4e78c0bf9d9b359328f3de8751ebb1.png" width="1668" height="363" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="important-puppets">Important Puppets<a href="#important-puppets" class="hash-link" aria-label="Important PuppetsÁöÑÁõ¥Êé•ÈìæÊé•" title="Important PuppetsÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><table><thead><tr><th>Puppet Name</th><th>Description</th></tr></thead><tbody><tr><td>PuppetPuppeteer</td><td>A web solution to connect WeChat, Wechaty init  is implemented by web WeChat, which injects JavaScript code into chrome.</td></tr><tr><td>PuppetMock</td><td>A mock function to connect WeChat, not a real implementation, for testing other connectors to connect with Wechaty. This is used to further to connect other solutions, such as iPad, Xposed, iOS and windows client,</td></tr><tr><td>PuppetPadLocal</td><td>An iPad solution to connect WeChat.</td></tr><tr><td>PuppetService</td><td>It is a gRPC solution.</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-puppet-with-wechaty-examples">Using Puppet with Wechaty Examples<a href="#using-puppet-with-wechaty-examples" class="hash-link" aria-label="Using Puppet with Wechaty ExamplesÁöÑÁõ¥Êé•ÈìæÊé•" title="Using Puppet with Wechaty ExamplesÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><ol><li><p>Using <a href="https://www.npmjs.com/package/wechaty-puppet-mock" target="_blank" rel="noopener noreferrer">wechaty-puppet-mock</a> to run <a href="https://github.com/wechaty/wechaty/blob/main/examples/ding-dong-bot.ts" target="_blank" rel="noopener noreferrer">ding-dong-bot</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WECHATY_PUPPET=wechaty-puppet-mock npm start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Using <a href="https://www.npmjs.com/package/wechaty-puppet-padpro" target="_blank" rel="noopener noreferrer">wechaty-puppet-padpro</a> to run <a href="https://github.com/wechaty/wechaty/blob/main/examples/ding-dong-bot.ts" target="_blank" rel="noopener noreferrer">ding-dong-bot</a></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WECHATY_PUPPET=wechaty-puppet-padpro npm start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basic-rules">Basic Rules<a href="#basic-rules" class="hash-link" aria-label="Basic RulesÁöÑÁõ¥Êé•ÈìæÊé•" title="Basic RulesÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>Here are some rules that a Wechaty Puppet should follow:</p><ol><li><strong>Emit Self Messages</strong>: when the bot says anything, the bot should receive a message said by itself. (and the <code>message.self()</code> will return true for this message)</li><li><strong>Perfect Logout</strong>: <code>logout</code> method should clean all the user session data from the puppet service, and the status of the App on the phone should display correctly (not log in on any devices).</li><li><strong>State-less Session Management</strong> (with MemoryCard support): the puppet service should save the user session data to the memory card, and can be restored from the memory card.</li><li><strong>MIME File Name Extension Convention</strong>: FileBoxChunk.name must be able to convert to a MIME type and visa versa. The puppet needs to set the name with the right extension (.jpg, .pdf, etc) to the name of the file box. <a href="https://github.com/wechaty/wechaty-puppet-hostie/discussions/115" target="_blank" rel="noopener noreferrer">See</a>,
<a href="https://github.com/wechaty/puppet-services/discussions/54" target="_blank" rel="noopener noreferrer">See</a></li><li><strong>Perfect Restart</strong>: the puppet should be able to restart at least 3 times in the unit tests, and do not leave any timer in the event loop after the testings. (i.e. <a href="https://github.com/wechaty/wechaty-puppet-service/blob/7d7fb5815b1288b2e7c31f6e67d3edfe57c7c277/src/client/puppet-service.spec.ts#L18-L30" target="_blank" rel="noopener noreferrer">this unit test</a>)</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="memorycard">MemoryCard<a href="#memorycard" class="hash-link" aria-label="MemoryCardÁöÑÁõ¥Êé•ÈìæÊé•" title="MemoryCardÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>When a Wechaty bot is logged in, it will have a authorized secret data to store logged-in session, for example, the device information (62 data for pad protocol), the cookie (if you are using the web protocol), and the user session secrets, etc.</p><p>The <a href="https://github.com/huan/memory-card" target="_blank" rel="noopener noreferrer">memory card</a> is a module designed to store those data.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wechaty-bot-login-with-memory-card-module">Wechaty bot login with memory card module<a href="#wechaty-bot-login-with-memory-card-module" class="hash-link" aria-label="Wechaty bot login with memory card moduleÁöÑÁõ¥Êé•ÈìæÊé•" title="Wechaty bot login with memory card moduleÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><ol><li>wechaty start()</li><li>wechaty instanciates memory card (see <a href="https://github.com/wechaty/wechaty/blob/30c446b2b78c92166a1d613952e77d3e3fdbbe1f/src/wechaty.ts#L681" target="_blank" rel="noopener noreferrer">wechaty.ts:start()</a>)</li><li>wechaty set memory card to puppet (see <a href="https://github.com/wechaty/wechaty/blob/30c446b2b78c92166a1d613952e77d3e3fdbbe1f/src/wechaty.ts#L406" target="_blank" rel="noopener noreferrer">wechaty.ts:initPuppet()</a>)
a. puppet start()
b. puppet load session from memory card
c. puppet logged in
i. by loaded session, or
ii. by scan qr code
d. puppet save the session secret data to memory card</li><li>memory card will be saved to file or network storage for future reuse.</li></ol><p>By saving the user login session secret data to memory card, the Wechaty system can save the state to local, so that it can make the puppet service provider stateless.
Currently neither of the Donut, WXWork, Rock, PadLocal have support for this stateless feature, nor the Wechaty system is ready for it.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-order">Event Order<a href="#event-order" class="hash-link" aria-label="Event OrderÁöÑÁõ¥Êé•ÈìæÊé•" title="Event OrderÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>The order of events before the bot starts is very important and this section explains it in a a detailed manner:</p><ol><li>When you first start the bot, the <code>login</code> event is first  generated.</li><li>However, the Wechaty system needs to load the contact payload of the <code>userSelf</code> before it emits the <code>login</code> event because the login event of Wechaty needs to take a <code>userSelf</code> instance.So there will be some delay before the Wechaty emit the <code>login</code> event after it received the <code>login</code> event from its puppet.</li><li>Then the <code>ready-ed</code> event is generated.The event is generated just before the <code>ready</code> event.</li><li>Then lastly the <code>ready</code> event is generated.</li></ol><p>For a more robust Wechaty system, we can consider saving the <code>ready</code> event if the <code>login</code> event is not emitted in Wechaty and when we emit the <code>login</code> event in Wechaty, we can check if the puppet has already <code>ready-ed</code>, and if so, it can emit the <code>ready</code> event right after the <code>login</code> event.<a href="https://github.com/wechaty/puppet-services/issues/31" target="_blank" rel="noopener noreferrer">See</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-ready">Event: <code>ready</code><a href="#event-ready" class="hash-link" aria-label="event-readyÁöÑÁõ¥Êé•ÈìæÊé•" title="event-readyÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>Need to fire <code>ready</code> event after the bot logined and all data has been synced.</p><blockquote><p>For example, after we re-installed the WeChat app on our phone, it has to load contacts/rooms from the server for a long time.
<a href="https://github.com/wechaty/wechaty-puppet-service/issues/18" target="_blank" rel="noopener noreferrer">check</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="payload-cache-management">Payload Cache Management<a href="#payload-cache-management" class="hash-link" aria-label="Payload Cache ManagementÁöÑÁõ¥Êé•ÈìæÊé•" title="Payload Cache ManagementÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><ol><li>If the low-level puppet wants to dirty a payload, emit a <code>dirty</code> event. The payload will be the <code>type</code> and the <code>id</code> of the paload</li><li>If the high-level puppet wants to dirty a payload, call <code>dirtyPayload(type, id)</code> method, what it does (and only does) is to make the low-level puppet emit a <code>dirty</code> event.</li><li>Each puppet should listen to the <code>dirty</code> event, and call <code>XXXPayloadDirty(id)</code> to purge the internal cache of the specific payload inside itself
Related issues:</li></ol><ul><li><a href="https://github.com/wechaty/wechaty-puppet-service/issues/164" target="_blank" rel="noopener noreferrer">Specification for dirty event, dirtyPayload(), and `XXXPayloadDirty() to puppet abstraction, puppet implementation, puppet server, and puppet client. wechaty/wechaty-puppet-service#164</a></li><li><a href="https://github.com/wechaty/wechaty-puppet-service/issues/43" target="_blank" rel="noopener noreferrer">No contactPayloadDirty method in puppet-implementation. wechaty/wechaty-puppet-service#43</a></li><li><a href="https://github.com/wechaty/grpc/pull/79" target="_blank" rel="noopener noreferrer">add dirty rpc function definition for sync data wechaty/grpc#79</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-heartbeat">Event: <code>heartbeat</code><a href="#event-heartbeat" class="hash-link" aria-label="event-heartbeatÁöÑÁõ¥Êé•ÈìæÊé•" title="event-heartbeatÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>Puppet must emit heartbeats to provide a health check signal.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-heartbeat-design">The <code>heartbeat</code> design<a href="#the-heartbeat-design" class="hash-link" aria-label="the-heartbeat-designÁöÑÁõ¥Êé•ÈìæÊé•" title="the-heartbeat-designÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>Here are the details:</p><ol><li>Wechaty Puppet is designed to emit at least one event in 60 seconds. If we do not have any events to emit, then we need to emit a <code>heartbeat</code> event so that it can prove itself as alive and healthy. <a href="https://github.com/wechaty/wechaty-puppet/blob/bab9e29c088c33fa8bc6e148d9bdadbd453fd138/src/puppet.ts#L253-L254" target="_blank" rel="noopener noreferrer">See</a></li><li>It seems that the PadLocal does not have any <code>heartbeat</code> event to emit when there are no other events, so if your bot idle for more than 60 seconds, then the Wechaty Puppet system will think the puppet provider is dead, so it will call <code>reset</code> to try to recover the puppet.</li></ol><p>A leaking of <code>heartbeat</code> example logs:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">02:00:13 INFO StarterBot Message#Text[üó£Contact&lt;OssChat&gt;@üë•Room&lt;ChatOps - Heartbeat üíñ&gt;] [Â§™Èò≥]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 WARN Puppet dogReset() reason: {&quot;data&quot;:&quot;onGrpcStreamEvent(EVENT_TYPE_MESSAGE)&quot;,&quot;timeout&quot;:60000}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB Puppet reset(onGrpcStreamEvent(EVENT_TYPE_MESSAGE))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService stop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; off(pending) &lt;- (false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService stopGrpcStream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService stopGrpcClient()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB Puppet selfId()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; off(true) &lt;- (pending)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 INFO StarterBot Contact&lt;Mike (ÊùéÂçìÊ°ì)&gt; logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB StateSwitch &lt;PuppetService&gt; on(pending) &lt;- (false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService startGrpcClient()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:13 VERB PuppetService discoverServiceIp(e49007b7-7523-4a80-bfdb-1be0de3844b9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:14 VERB PuppetService startGrpcStream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:14 VERB StateSwitch &lt;PuppetService&gt; on(true) &lt;- (pending)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:14 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_LOGIN(25), payload:&quot;{&quot;contactId&quot;:&quot;wxid_a8d806dzznm822&quot;}&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:14 INFO StarterBot Contact&lt;Mike (ÊùéÂçìÊ°ì)&gt; login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:15 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_READY(23), payload:&quot;{&quot;data&quot;:&quot;ready&quot;}&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:15 VERB StateSwitch &lt;WechatyReady&gt; on(true) &lt;- (true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:20 VERB PuppetService onGrpcStreamEvent({type:EVENT_TYPE_READY(23), payload:&quot;{&quot;data&quot;:&quot;ready&quot;}&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:01:20 VERB StateSwitch &lt;WechatyReady&gt; on(true) &lt;- (true)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="heartbeat-example"><code>heartbeat</code> Example<a href="#heartbeat-example" class="hash-link" aria-label="heartbeat-exampleÁöÑÁõ¥Êé•ÈìæÊé•" title="heartbeat-exampleÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>Here&#x27;s an <a href="https://github.com/wechaty/wechaty-puppet-puppeteer/blob/07f6260b3784c65bcee24bd003aac5d2968a9efc/src/wechaty-bro.js#L103-L112" target="_blank" rel="noopener noreferrer">example</a> from our puppeteer puppet, which emits heartbeats in the browser, so if the browser dead, we will get to know because the heartbeat will be lost.Also check out the docs on <a href="https://wechaty.js.org/docs/using-plugin-with-wechaty/heartbeat" target="_blank" rel="noopener noreferrer">Heartbeat Plugin</a>.</p><p><a href="https://github.com/wechaty/puppet-services/issues/85#issuecomment-769967606" target="_blank" rel="noopener noreferrer">Check the link</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="important-links">Important Links<a href="#important-links" class="hash-link" aria-label="Important LinksÁöÑÁõ¥Êé•ÈìæÊé•" title="Important LinksÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>Please refer to the below links for more information on different methods of Message class:</p><ul><li><a href="https://developers.weixin.qq.com/doc/offiaccount/Asset_Management/New_temporary_materials.html" target="_blank" rel="noopener noreferrer">message material in official-account</a></li><li><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/master/src/official-account/official-account.ts#L299" target="_blank" rel="noopener noreferrer">sendFile method</a></li><li><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/master/src/puppet-oa.ts#L495" target="_blank" rel="noopener noreferrer">messageSend method</a></li></ul><p>Wechaty now support very limited Message types for more information <a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L241-L244" target="_blank" rel="noopener noreferrer">check here</a>
In order to support receiving more message types, like audio, <a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/webhook.ts#L247-L252" target="_blank" rel="noopener noreferrer">look here</a></p><blockquote><p>Also note that <strong>Video</strong> type Message is not supported right now by Wechaty.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wechaty-puppet-message-processing-flow">Wechaty Puppet Message Processing Flow<a href="#wechaty-puppet-message-processing-flow" class="hash-link" aria-label="Wechaty Puppet Message Processing FlowÁöÑÁõ¥Êé•ÈìæÊé•" title="Wechaty Puppet Message Processing FlowÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><ol><li><p>The Webhook gets called by the Tencent Server.</p></li><li><p>The message <strong>event</strong> will be propagated from the <code>Webhook</code> class to the <code>OfficialAccount</code> class:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/official-account.ts#L116-L119" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/official-account/official-account.ts#L116-L119</a></p></li><li><p>The message <strong>event</strong> will be propagated from the <code>OfficialAccount</code> class to the <code>PuppetOA</code> class:</p><p><a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L188-L189" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L188-L189</a></p></li><li><p>After message <strong>event</strong> be propagated from the PuppetOA to Wechaty, then the <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/puppet.ts#L834" target="_blank" rel="noopener noreferrer">puppet.messagePayload()</a> will be called to get the <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/schemas/message.ts#L103" target="_blank" rel="noopener noreferrer">Wechaty Message Payload</a>.  Here is the most important part: we need to construct a Wechaty Message Payload from the Raw Message Payload (source code at <a href="https://github.com/wechaty/wechaty-puppet/blob/763e94194fd1104007fccad4ba4994365890cde8/src/puppet.ts#L854-L855" target="_blank" rel="noopener noreferrer">here</a>):</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> rawPayload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">messageRawPayload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messageId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> payload    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">messageRawPayloadParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rawPayload</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p><img loading="lazy" alt="Message Processing flow" src="/zh/assets/images/messageprocess-flow-e60a6857ba4bbe59d289582d1471b819.webp" title="Message processing flow" width="251" height="667" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="future-enhancements">Future Enhancements<a href="#future-enhancements" class="hash-link" aria-label="Future EnhancementsÁöÑÁõ¥Êé•ÈìæÊé•" title="Future EnhancementsÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p> Futute enhancements can be to  add more types of Message that Wechaty can support by implementing the <code>messageRawPayload</code> methods, which can be <a href="https://github.com/wechaty/wechaty-puppet-official-account/blob/381ffb820fcc63e4b89a99c433b696e790e06b7a/src/puppet-oa.ts#L456-L478" target="_blank" rel="noopener noreferrer">found here</a> and also check out this <a href="https://github.com/wechaty/wechaty-puppet-official-account/issues/19" target="_blank" rel="noopener noreferrer">link</a> for more information.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wechaty-puppet-uses">Wechaty Puppet Uses<a href="#wechaty-puppet-uses" class="hash-link" aria-label="Wechaty Puppet UsesÁöÑÁõ¥Êé•ÈìæÊé•" title="Wechaty Puppet UsesÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dingdong-protocol"><code>Ding</code>/<code>Dong</code> Protocol<a href="#dingdong-protocol" class="hash-link" aria-label="dingdong-protocolÁöÑÁõ¥Êé•ÈìæÊé•" title="dingdong-protocolÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h4><p>Ding dong protocol is a rule built using the Puppet which has a API named <code>ding(data: string): void</code>, and the Puppet has the following functionality:</p><ol><li>emit a <code>dong</code> event when the <code>ding()</code> method has been called</li><li>the payload of the <code>dong</code> event might contains a <code>data</code> key with the value exactly match the <code>data</code> when calling the <code>ding()</code> method.</li></ol><p>For further information about the  uses Ding dong protocol check out <a href="https://wechaty.js.org/docs/examples/basic/ding-dong-bot" target="_blank" rel="noopener noreferrer">Ding Dong Bot</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="learn-more">Learn More<a href="#learn-more" class="hash-link" aria-label="Learn MoreÁöÑÁõ¥Êé•ÈìæÊé•" title="Learn MoreÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><ul><li>Puppet Related Links: <a href="https://github.com/wechaty/wechaty-puppet/wiki/Links" target="_blank" rel="noopener noreferrer">https://github.com/wechaty/wechaty-puppet/wiki/Links</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="npm-publications">NPM publications<a href="#npm-publications" class="hash-link" aria-label="NPM publicationsÁöÑÁõ¥Êé•ÈìæÊé•" title="NPM publicationsÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><ul class="contains-task-list containsTaskList_mC6p"><li class="task-list-item"><input type="checkbox" disabled=""> <code>wechaty-puppet</code> is not a dependency. It should be put in devDependencies and peerDependencies</li><li class="task-list-item"><input type="checkbox" disabled=""> <code>wechaty</code> is not a dependency. It should be put in devDependencies and peerDependencies</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->must exist <code>examples/ding-dong-bot.ts</code> to implement the ding/dong logic, use puppet API only.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wechaty/docusaurus/edit/main/docusaurus/docs/specs/puppet.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ÁºñËæëÊ≠§È°µ</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">ÊúÄÂêé<!-- -->Áî± <b>Huan (ÊùéÂçìÊ°ì)</b> <!-- -->‰∫é <b><time datetime="2021-09-30T10:07:16.000Z">2021Âπ¥9Êúà30Êó•</time></b> <!-- -->Êõ¥Êñ∞</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Êñá‰ª∂ÈÄâÈ°πÂç°"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/specs/plugin"><div class="pagination-nav__sublabel">‰∏ä‰∏ÄÈ°µ</div><div class="pagination-nav__label">Plugin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/specs/service"><div class="pagination-nav__sublabel">‰∏ã‰∏ÄÈ°µ</div><div class="pagination-nav__label">Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-wechaty-puppet" class="table-of-contents__link toc-highlight">What is Wechaty Puppet</a></li><li><a href="#show-me-the-code" class="table-of-contents__link toc-highlight">Show me the code</a><ul><li><a href="#important-puppets" class="table-of-contents__link toc-highlight">Important Puppets</a></li></ul></li><li><a href="#using-puppet-with-wechaty-examples" class="table-of-contents__link toc-highlight">Using Puppet with Wechaty Examples</a></li><li><a href="#basic-rules" class="table-of-contents__link toc-highlight">Basic Rules</a></li><li><a href="#memorycard" class="table-of-contents__link toc-highlight">MemoryCard</a><ul><li><a href="#wechaty-bot-login-with-memory-card-module" class="table-of-contents__link toc-highlight">Wechaty bot login with memory card module</a></li></ul></li><li><a href="#event-order" class="table-of-contents__link toc-highlight">Event Order</a></li><li><a href="#event-ready" class="table-of-contents__link toc-highlight">Event: <code>ready</code></a></li><li><a href="#payload-cache-management" class="table-of-contents__link toc-highlight">Payload Cache Management</a></li><li><a href="#event-heartbeat" class="table-of-contents__link toc-highlight">Event: <code>heartbeat</code></a><ul><li><a href="#the-heartbeat-design" class="table-of-contents__link toc-highlight">The <code>heartbeat</code> design</a></li><li><a href="#heartbeat-example" class="table-of-contents__link toc-highlight"><code>heartbeat</code> Example</a></li><li><a href="#important-links" class="table-of-contents__link toc-highlight">Important Links</a></li><li><a href="#wechaty-puppet-message-processing-flow" class="table-of-contents__link toc-highlight">Wechaty Puppet Message Processing Flow</a></li><li><a href="#future-enhancements" class="table-of-contents__link toc-highlight">Future Enhancements</a></li><li><a href="#wechaty-puppet-uses" class="table-of-contents__link toc-highlight">Wechaty Puppet Uses</a></li><li><a href="#learn-more" class="table-of-contents__link toc-highlight">Learn More</a></li></ul></li><li><a href="#npm-publications" class="table-of-contents__link toc-highlight">NPM publications</a></li></ul></div></div></div></div></main></div></div><main id="body"><footer id="footer"><div id="footerUpper"><div id="footerFirstColumn"><p id="footerColumnEmphasis"> Docs </p><p id="footerColumnOne"><a href="docs/wechaty"> Introduction </a><br><a href="docs/tutorials/"> Tutorials </a><br><a href="docs/howto/"> How-to Guides </a><br><a href="docs/references/"> References </a><br><a href="docs/explanations/"> Explanations </a><br></p></div><div id="footerSecondColumn"><p id="footerColumnEmphasis"> Community </p><p id="footerColumnTwo"><a href="https://gitter.im/wechaty/wechaty"> Gitter </a><br><a href="https://github.com/wechaty/wechaty/discussions"> Discussion </a><br><a href="https://stackoverflow.com/questions/tagged/wechaty"> Stack Overflow </a><br><a href="https://t.me/wechaty"> Telegram </a><br><a href="https://twitter.com/chatieio"> Twitter </a><br><a href="https://bit.ly/3aoLE86"> YouTube </a><br><a href="https://opencollective.com/wechaty"> Open Collective </a><br><a href="https://bit.ly/33Dfkuf"> Google Drive </a><br><a href="https://photos.app.goo.gl/LkmYMWypGoJdyvEJ6"> Photo Album </a><br><a href="https://bit.ly/2zpi2XG"> Meeting Notes </a><br><a href="https://bit.ly/2J6ziXa"> Hall of Fame </a><br></p></div><div id="footerThirdColumn"><div id="footerColumnEmphasisFirst"><p id="footerColumnEmphasis"> More </p></div><p id="footerColumnThree"><a href="https://wechaty.js.org/blog/"> Blog </a><br><a href="http://www.bot5.ml/blogs/chatbot-0-1/"> Book </a><br><a href="https://wechaty.js.org/docs/marketing/branding/"> Branding </a><br><a href="press"> Press </a><br><a href="https://github.com/wechaty/wechaty#readme"> GitHub </a><br><a href="https://chatie.statuspage.io/"> Status </a><br></p></div><div id="scannerWrapper"><img alt="Wechaty QR Scanner" id="scanner" src="/img/discord-qrcode.svg"><strong id="footerColumnEmphasis">Join our WeChat Room<br></strong><p id="scannerText">You are welcome to join our Wechaty Developers&#x27; Home by scanning the above QR code, then send the secret code &quot;wechaty&quot; to Friday.BOT.</p></div></div><div id="wechatyLogoFooter"><img alt="Wechaty Logo" src="/img/wechatylogofooter.webp"></div><p id="codeOfConductText"><a> Code of Conduct </a></p><p id="copyrightText">Copyright ¬© 2016-2021 Wechaty Contributors</p></footer></main></div>
<script src="/zh/assets/js/runtime~main.2ba15057.js"></script>
<script src="/zh/assets/js/main.b3311afd.js"></script>
</body>
</html>