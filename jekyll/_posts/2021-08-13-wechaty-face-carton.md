---
title: "Wechatyå¡é€šPå›¾æ’ä»¶ï¼Œ18è¡Œä»£ç å¸®ä½ å®ç°å˜è„¸åŠŸèƒ½ "
author: leochen-g
categories: article
tags:
  - code
  - face-carton
  - plugin
image: /assets/2021/08-wechaty-face-carton/main.webp
---

Wechaty äººåƒè½¬æ¢æ’ä»¶ï¼Œè®©ä½ çš„ Wechaty æœºå™¨äººå®ç°ç…§ç‰‡å¡é€šåŒ–ï¼Œå¹´é¾„å˜åŒ–ï¼Œæ€§åˆ«å˜åŒ–ç­‰åŠŸèƒ½ã€‚ä¹‹å‰æœ‰çœ‹åˆ°è¿‡ä¸€äº›æœºå™¨å­¦ä¹ è§†é¢‘ï¼Œå¯ä»¥æŠŠç…§ç‰‡æ¼«ç”»åŒ–ï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°±æƒ³ç€èƒ½ä¸èƒ½ç»“åˆ Wechaty åšä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¿”å›åŠ¨æ¼«åŒ–ç…§ç‰‡çš„æœºå™¨äººã€‚ç»è¿‡ä¸€ç•ªèµ„æ–™æŸ¥æ‰¾ï¼Œå‘ç°è…¾è®¯æœ‰ä¸ªäººè„¸å˜æ¢çš„åŠŸèƒ½ï¼Œç»è¿‡æµ‹è¯•åï¼Œå‘ç°å°±æ˜¯æˆ‘æƒ³è¦çš„åŠŸèƒ½ï¼Œè€Œä¸”æ•ˆæœè¿˜ä¸é”™ï¼Œå…³é”®æ˜¯æ¯ä¸ªæœˆæœ‰ 1000 æ¬¡çš„å…è´¹é¢åº¦ï¼Œè¿™å°±å¾ˆé¦™äº†ã€‚ä¸‰ç§è½¬æ¢æ¨¡å¼å°±æ˜¯ 3000 æ¬¡ï¼Œç™½å«–ä¸é¦™ä¹ˆ ğŸ˜ï¼Œç™½å«–è…¾è®¯è¿™å°±æ›´é¦™äº†ï¼Œå“ˆå“ˆã€‚

å¦‚æœä½ è¯´ä½ çš„å¾®ä¿¡æ²¡æ³•ç™»é™†ç½‘é¡µç‰ˆå¾®ä¿¡ï¼Œæ²¡å…³ç³»`wechaty-puppet-wechat`åè®®æ˜¯åŸºäº UOS æ¡Œé¢ç‰ˆçš„ï¼Œæ–°è´¦å·ä¹Ÿå¯ä»¥ç”¨çš„ã€‚

## å®ç°åŠŸèƒ½ï¼š

ç§èŠå’Œç¾¤å†…éƒ½å¯ä»¥å®ç°ç…§ç‰‡ç‰¹æ•ˆ

- å¤šè½®äº¤äº’å¼å¯¹è¯å®ç°
  - äººè„¸ç…§ç‰‡åŠ¨æ¼«åŒ–
  - äººè„¸å¹´é¾„å˜åŒ–
  - äººè„¸æ€§åˆ«è½¬æ¢

## æ•ˆæœå±•ç¤º

![æ•ˆæœå±•ç¤º](/assets/2021/08-wechaty-face-carton/picall.webp)

## å‡†å¤‡è…¾è®¯äº‘è´¦å·

### å¼€é€šç…§ç‰‡è½¬æ¢åŠŸèƒ½

ç™»å½•[è…¾è®¯äº‘](https://curl.qcloud.com/ZtRitpvH)è´¦å·ï¼Œæ²¡æœ‰å°±ç›´æ¥ QQ ç™»å½•ï¼Œç›´æ¥ç‚¹å‡»ç®¡ç†æ§åˆ¶å°å¼€é€šå³å¯ï¼Œä¸ç”¨ä»˜è´¹ï¼Œä¹Ÿä¸ç”¨é€‰èµ„æºåŒ…ï¼Œå¼€é€šåè‡ªåŠ¨æœ‰æ¯ä¸ªæœˆ 1000 æ¬¡çš„å…è´¹é¢åº¦ï¼Œå¦‚æœè‡ªå·±å’Œæœ‹å‹ç©å®Œå…¨è¶³å¤Ÿäº†ã€‚å¦‚æœä½ æ˜¯æƒ³æ´»è·ƒç¤¾ç¾¤æˆ–è€…åœŸè±ªï¼Œå°±éšä¾¿å……å€¼äº†

![è…¾è®¯äº‘](/assets/2021/08-wechaty-face-carton/tencent.webp)

### è·å–è…¾è®¯çš„ secretid å’Œ secretkey

è®¿é—®æ­¤é¡µé¢[https://console.cloud.tencent.com/cam/capi](https://console.cloud.tencent.com/cam/capi)è·å–ä½ çš„`secretid`å’Œ`secretkey`,é…ç½®æ’ä»¶çš„æ—¶å€™éœ€è¦ç”¨çš„åˆ°

## ä½¿ç”¨æ­¥éª¤

### 1ã€åˆå§‹åŒ–é¡¹ç›®

nodeç¯å¢ƒéœ€è¦è‡ªå·±é…ç½®ä¸€ä¸‹ï¼Œnode>=14ï¼Œã€‚æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`face-carton`ï¼Œåœ¨æ–‡ä»¶å¤¹å†…éƒ¨æ‰§è¡Œ`npm init`ï¼Œä¸€è·¯å›è½¦å³å¯

### 2ã€å®‰è£…å¤´åƒè½¬åŒ–æ’ä»¶å’Œ Wechaty

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œå¤´åƒè½¬åŒ–æ’ä»¶`wechaty-face-carton`å°±æ˜¯æˆ‘è¿™æ¬¡åšçš„ä¸»è¦åŠŸèƒ½ï¼Œå·²ç»å¼€æºåœ¨[github](https://github.com/leochen-g/wechaty-face-carton)ï¼Œç”±äºå·²ç»å‘å¸ƒåˆ°npmï¼Œæ‰€ä»¥è¿™é‡Œä½ åªéœ€è¦å®‰è£…å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¯¹äºä¸å…³å¿ƒä»£ç çš„ç«¥é‹ï¼Œç›´æ¥å®‰è£…ä½¿ç”¨å°±è¡Œäº†ã€‚å¦‚æœæƒ³çŸ¥é“ä»£ç æ€ä¹ˆå®ç°çš„ï¼Œå¯ä»¥åˆ°githubä»“åº“æŸ¥çœ‹ä¸€ä¸‹æºç ã€‚

é…ç½® `npm` æºä¸ºæ·˜å®æºï¼ˆé‡è¦ï¼Œå› ä¸ºéœ€è¦å®‰è£… `chromium`ï¼Œä¸é…ç½®çš„è¯ä¸‹è½½ä¼šå¤±è´¥æˆ–è€…é€Ÿåº¦å¾ˆæ…¢ï¼Œå› ä¸ºè¿™ä¸ªç©æ„ 140M å·¦å³ï¼‰

```terminal
npm config set registry https://registry.npm.taobao.org
npm config set disturl https://npm.taobao.org/dist
npm config set puppeteer_download_host https://npm.taobao.org/mirrors

npm install wechaty wechaty-face-carton wechaty-puppet-wechat --save
```

### 3ã€ä¸»è¦ä»£ç ï¼ˆä¸è¶…è¿‡20è¡Œï¼‰

index.js

```javascript
const { Wechaty } = require('wechaty')
const WechatyFaceCartonPlugin = require('wechaty-face-carton')
const name = 'wechat-carton'
const bot = new Wechaty({ name, puppet: 'wechaty-puppet-wechat' })
bot
  .use(
    WechatyFaceCartonPlugin({
      maxuser: 20, // æ”¯æŒæœ€å¤šå¤šå°‘äººè¿›è¡Œå¯¹è¯ï¼Œå»ºè®®ä¸è¦è®¾ç½®å¤ªå¤šï¼Œå¦åˆ™å ç”¨å†…å­˜ä¼šå¢åŠ 
      secretId: 'è…¾è®¯secretId', // è…¾è®¯secretId
      secretKey: 'è…¾è®¯secretKey', // è…¾è®¯secretKey
      allowUser: ['Leo_chen'], // å…è®¸å“ªäº›å¥½å‹ä½¿ç”¨äººåƒæ¼«ç”»åŒ–åŠŸèƒ½ï¼Œä¸ºç©º[]ä»£è¡¨æ‰€æœ‰äººå¼€å¯
      allowRoom: ['æµ‹è¯•1'], // å…è®¸å“ªäº›ç¾¤ä½¿ç”¨äººåƒæ¼«ç”»åŒ–åŠŸèƒ½ï¼Œä¸ºç©º[]ä»£è¡¨ä¸å¼€å¯ä»»ä½•ä¸€ä¸ªç¾¤
      quickModel: true, // å¿«é€Ÿä½“éªŒæ¨¡å¼ é»˜è®¤å…³é—­ å¼€å¯åå¯ç›´æ¥ç”ŸæˆäºŒç»´ç æ‰«æä½“éªŒï¼Œå¦‚æœè‡ªå·±ä»£ç æœ‰ç™»å½•é€»è¾‘å¯ä»¥ä¸é…ç½®æ­¤é¡¹
      tipsword: 'å¡é€š', // ç§èŠå‘é€æ¶ˆæ¯ï¼Œè§¦å‘ç…§ç‰‡å¡é€šåŒ–æç¤º å¦‚æœç›´æ¥å‘é€å›¾ç‰‡ï¼Œé»˜è®¤è¿›å…¥å›¾ç‰‡å¡é€šåŒ–åŠŸèƒ½ï¼Œä¸å¡«åˆ™å½“ç”¨æˆ·åˆæ¬¡å‘é€æ–‡å­—æ¶ˆæ¯æ—¶ä¸åšä»»ä½•å¤„ç†
    })
  )
  .start()
  .catch((e) => console.error(e))
```

#### å‚æ•°è¯´æ˜

| å‚æ•°å     | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜                                                                                                                                       |
| ---------- | ---- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------ |
| maxuser    | å¦   | 20     | æ”¯æŒæœ€å¤šå¤šå°‘äººè¿›è¡Œå¯¹è¯ï¼Œå»ºè®®ä¸è¦è®¾ç½®å¤ªå¤šï¼Œå¦åˆ™å ç”¨å†…å­˜ä¼šå¢åŠ                                                                                |
| secretId:  | æ˜¯   | ''     | è…¾è®¯ secretId                                                                                                                              |
| secretKey  | æ˜¯   | ''     | è…¾è®¯ secretKey                                                                                                                             |
| allowUser  | å¦   | []     | å…è®¸å“ªäº›å¥½å‹ä½¿ç”¨äººåƒæ¼«ç”»åŒ–åŠŸèƒ½ï¼Œä¸ºç©º[]ä»£è¡¨æ‰€æœ‰äººå¼€å¯                                                                                       |
| allowRoom  | å¦   | []     | å…è®¸å“ªäº›ç¾¤ä½¿ç”¨äººåƒæ¼«ç”»åŒ–åŠŸèƒ½ï¼Œä¸ºç©º[]ä»£è¡¨ä¸å¼€å¯ä»»ä½•ä¸€ä¸ªç¾¤                                                                                   |
| quickModel | å¦   | false  | å¿«é€Ÿä½“éªŒæ¨¡å¼ é»˜è®¤å…³é—­ å¼€å¯åå¯ç›´æ¥ç”ŸæˆäºŒç»´ç æ‰«æä½“éªŒï¼Œå¦‚æœè‡ªå·±ä»£ç æœ‰ç™»å½•é€»è¾‘å¯ä»¥ä¸é…ç½®æ­¤é¡¹ï¼Œå¦‚æœæ˜¯å•ç‹¬ä½¿ç”¨æ­¤æ’ä»¶ï¼Œå»ºè®®å¼€å¯                 |
| tipsword   | å¦   | 'å¡é€š' | ç§èŠå‘é€æ¶ˆæ¯ï¼Œè§¦å‘ç…§ç‰‡å¡é€šåŒ–æç¤ºã€‚å¦‚æœç›´æ¥å‘é€å›¾ç‰‡ï¼Œé»˜è®¤è¿›å…¥å›¾ç‰‡å¡é€šåŒ–åŠŸèƒ½ï¼Œä¸å¡«åˆ™å½“ç”¨æˆ·åˆæ¬¡å‘é€æ–‡å­—æ¶ˆæ¯æ—¶ä¸åšä»»ä½•å¤„ç†ï¼Œå»ºè®®å¡«å†™è§¦å‘å…³é”®è¯ |

### 4ã€è¿è¡Œ

```bash
node index.js
```

æ‰«ç ç™»å½•åï¼Œç»™å°åŠ©æ‰‹å‘é€å›¾ç‰‡ï¼Œå³å¯è½¬åŒ–å›¾ç‰‡ï¼Œå¯¹äºä¸èƒ½è½¬åŒ–çš„å›¾ç‰‡ï¼Œå°åŠ©æ‰‹ä¼šç»™å‡ºåŸå› 

## dockerè¿è¡Œ

### 1ã€æ–°å»ºDockerfile

å¦‚æœé‡åˆ°è¿‡å¤šçš„ç¯å¢ƒé—®é¢˜è®©ä½ éå¸¸è‹¦æ¼ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä»¥ä¸Šç¬¬ä¸‰æ­¥å®Œæˆåï¼Œæ ¹ç›®å½•æ–°å»ºä¸€ä¸ª`Dockerfile`æ–‡ä»¶ï¼Œé‡Œé¢å¡«å…¥å†…å®¹ï¼Œå¯¹ï¼å°±ä¸€è¡Œå°±è¡Œï¼

```docker
FROM wechaty/onbuild
```

### 2ã€buildé•œåƒ

å®Œæˆåå°±å¯ä»¥ç›´æ¥buildé•œåƒ

```bash
docker build -t wechaty-carton .
```

### 3ã€è¿è¡Œé•œåƒ

buildå®Œæˆåå°±å¯ä»¥ç›´æ¥runåæ‰«ç äº†

```bash
docker run wechaty-carton
```

## æ³¨æ„

è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸è¦æŠŠé¢åº¦ç”¨è¶…äº†ï¼Œç”¨è¶…äº†å°±ä¸èƒ½ç”¨äº†ã€‚

> å†å²æ–‡ç« 

- [wechaty-web-panelå¯è§†åŒ–æ’ä»¶](https://wechaty.js.org/2020/05/31/wechaty-web-panel-plugin/)
- [ä¸‰æ­¥æ•™ä½ ç”¨Nodeåšä¸€ä¸ªå¾®ä¿¡è„±å•ç¥å™¨ï¼Œå°ç™½å¯ä¸Šæ‰‹](https://wechaty.js.org/2019/06/21/three-step-get-girlfriend/)
- [é‡ç£…ï¼šä½¿ç”¨UOSå¾®ä¿¡æ¡Œé¢ç‰ˆåè®®ç™»å½•ï¼Œwechatyå…è´¹ç‰ˆwebåè®®é‡æ”¾è£å…‰](https://wechaty.js.org/2021/04/13/wechaty-uos-web/)

> ä½œè€…: [Leo_chen](https://github.com/leochen-g/)ï¼Œå…¨æ ˆå·¥ç¨‹å¸ˆï¼Œå–œæ¬¢ä½¿ç”¨nodeåšå„ç§é¡¹ç›®
